â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   DIAGRAMA DE BASE DE DATOS                                   â•‘
â•‘              PLANIFICADOR DE MANTENIMIENTO - SQL SERVER                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ESTRUCTURA DE TABLAS Y RELACIONES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SISTEMA DE USUARIOS                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      ğŸ‘¤ USUARIOS         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ PK  user_id (UUID)       â”‚â”€â”€â”
    â”‚     email                â”‚  â”‚
    â”‚     password_hash        â”‚  â”‚
    â”‚     nombre               â”‚  â”‚
    â”‚     rol                  â”‚  â”‚
    â”‚     is_active            â”‚  â”‚
    â”‚     failed_login_count   â”‚  â”‚
    â”‚     lockout_until        â”‚  â”‚
    â”‚     created_at           â”‚  â”‚
    â”‚     updated_at           â”‚  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â”‚                    â”‚
              â”‚                    â”‚
              â–¼                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  ğŸ” PASSWORD_RESET_TOKENSâ”‚  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚ PK  token_id (UUID)      â”‚  â”‚
    â”‚ FK  user_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”˜
    â”‚     token_hash           â”‚
    â”‚     expires_at           â”‚
    â”‚     used_at              â”‚
    â”‚     created_at           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SISTEMA DE TAREAS E INSPECCIONES                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    ğŸ·ï¸  ESTADOS           â”‚         â”‚   ğŸ“ UBICACIONES         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ PK  id_estado            â”‚â”€â”€â”      â”‚ PK  id_ubicacion         â”‚
    â”‚     codigo_estado        â”‚  â”‚      â”‚     edificio             â”‚
    â”‚     nombre_estado        â”‚  â”‚      â”‚     piso                 â”‚
    â”‚     color_hex            â”‚  â”‚      â”‚     oficina_aula         â”‚
    â”‚     orden_display        â”‚  â”‚      â”‚     codigo_ubicacion     â”‚
    â”‚     activo               â”‚  â”‚      â”‚     descripcion          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚     activa               â”‚
                                   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ğŸ” INSPECCIONES        â”‚  â”‚      â”‚      ğŸ“‹ TAREAS           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ PK  id_inspeccion        â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â–¶â”‚ PK  id_tarea             â”‚
    â”‚     nombre_tarea         â”‚  â”‚      â”‚ FK  id_estado â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”˜
    â”‚     edificio             â”‚  â”‚      â”‚ FK  id_inspeccion        â”‚
    â”‚     piso                 â”‚  â”‚      â”‚ FK  asignado_user_id â”€â”€â”€â”€â”‚â”€â”€â”€â”
    â”‚     oficina_aula         â”‚  â”‚      â”‚ FK  creado_por â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”¤
    â”‚     prioridad            â”‚  â”‚      â”‚                          â”‚   â”‚
    â”‚     datos_completos(JSON)â”‚  â”‚      â”‚     titulo               â”‚   â”‚
    â”‚ FK  creado_por â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”¼â”€â”€â”   â”‚     descripcion          â”‚   â”‚
    â”‚     timestamp_inspeccion â”‚  â”‚  â”‚   â”‚     asignado_a           â”‚   â”‚
    â”‚     fecha_creacion       â”‚  â”‚  â”‚   â”‚     fecha                â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚     fecha_inicio         â”‚   â”‚
                                   â”‚  â”‚   â”‚     fecha_finalizacion   â”‚   â”‚
                                   â”‚  â”‚   â”‚     inspeccion_data(JSON)â”‚   â”‚
                                   â”‚  â”‚   â”‚     prioridad            â”‚   â”‚
                                   â”‚  â”‚   â”‚     tiempo_estimado_min  â”‚   â”‚
                                   â”‚  â”‚   â”‚     costo_estimado       â”‚   â”‚
                                   â”‚  â”‚   â”‚     actualizado_por      â”‚   â”‚
                                   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                   â”‚  â”‚              â”‚                    â”‚
                                   â”‚  â”‚              â”‚                    â”‚
                                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”
                                   â”‚                 â”‚                    â”‚ â”‚
                                   â”‚                 â–¼                    â”‚ â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
    â”‚    ğŸ–¼ï¸  IMAGENES          â”‚  â”‚   â”‚  ğŸ“œ HISTORIAL_ESTADOS    â”‚      â”‚ â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚ â”‚
    â”‚ PK  id_imagen            â”‚  â”‚   â”‚ PK  id_historial         â”‚      â”‚ â”‚
    â”‚ FK  id_tarea â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”¼â”€â”€â”€â”‚ FK  id_tarea â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚ FK  subido_por â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”˜   â”‚ FK  estado_anterior      â”‚        â”‚
    â”‚     nombre_archivo       â”‚      â”‚ FK  estado_nuevo         â”‚        â”‚
    â”‚     tipo_mime            â”‚      â”‚ FK  cambiado_por â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚     data_base64          â”‚      â”‚     comentario           â”‚
    â”‚     tamaÃ±o_bytes         â”‚      â”‚     fecha_cambio         â”‚
    â”‚     tipo_imagen          â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚     descripcion          â”‚
    â”‚     fecha_subida         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”„ FLUJO DE DATOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. CREACIÃ“N DE TAREA DESDE INSPECCIÃ“N
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   Usuario completa wizard â”€â”€â–¶ Frontend envÃ­a datos JSON
                                        â”‚
                                        â–¼
                              Backend recibe inspecciÃ³n
                                        â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                                   â”‚
                      â–¼                                   â–¼
          Guardar en tabla              Crear tarea en tabla
          'inspecciones'                     'tareas'
          (datos_completos: JSON)       (referencia a inspecciÃ³n)
                      â”‚                                   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                          Â¿Hay imÃ¡genes adjuntas?
                                    â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚                   â”‚
                         SÃ                  NO
                          â”‚                   â”‚
                          â–¼                   â”‚
                  Guardar en tabla            â”‚
                    'imagenes'                â”‚
                  (base64 data URL)           â”‚
                          â”‚                   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          Trigger automÃ¡tico registra
                          cambio en 'historial_estados'


2. ACTUALIZACIÃ“N DE ESTADO
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   Usuario cambia estado â”€â”€â–¶ Frontend PUT /api/tasks/:id
                                        â”‚
                                        â–¼
                          Backend llama SP_actualizar_tarea
                                        â”‚
                                        â–¼
                              Actualizar en 'tareas'
                                        â”‚
                                        â–¼
                    Trigger TR_tareas_cambio_estado se activa
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                       â”‚
                    â–¼                                       â–¼
        Insertar en                         Actualizar fechas automÃ¡ticamente
      'historial_estados'                   (fecha_inicio si pasa a "en progreso")
                                            (fecha_fin si pasa a "finalizado")


3. AUTENTICACIÃ“N
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   Usuario introduce credenciales â”€â”€â–¶ Frontend POST /auth/login
                                                â”‚
                                                â–¼
                                    Backend llama SP_autenticar_usuario
                                                â”‚
                                                â–¼
                                      Â¿ContraseÃ±a correcta?
                                                â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚                                       â”‚
                           NO                                      SÃ
                            â”‚                                       â”‚
                            â–¼                                       â–¼
                SP_registrar_login_fallido          SP_limpiar_login_fallidos
                            â”‚                                       â”‚
                            â–¼                                       â–¼
                Incrementar failed_count            Resetear failed_count = 0
                Si >= 5: lockout_until              Actualizar ultimo_acceso
                        = +15 min                           â”‚
                            â”‚                               â”‚
                            â–¼                               â–¼
                    Retornar error 401          Crear sesiÃ³n y retornar OK


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”§ PROCEDIMIENTOS ALMACENADOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Procedimiento                       â”‚ FunciÃ³n                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SP_autenticar_usuario               â”‚ Login: obtener datos del usuario    â”‚
â”‚ SP_registrar_login_fallido          â”‚ Incrementar intentos fallidos       â”‚
â”‚ SP_limpiar_login_fallidos           â”‚ Resetear tras login exitoso         â”‚
â”‚ SP_crear_tarea_desde_inspeccion     â”‚ Crear nueva tarea                   â”‚
â”‚ SP_actualizar_tarea                 â”‚ Actualizar estado/asignaciÃ³n        â”‚
â”‚ SP_obtener_tarea_por_id             â”‚ Obtener tarea + imÃ¡genes            â”‚
â”‚ SP_obtener_todas_tareas             â”‚ Listar todas las tareas             â”‚
â”‚ SP_obtener_stats_dashboard          â”‚ EstadÃ­sticas para dashboard         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š VISTAS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vista                               â”‚ Uso                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VW_tareas_completas                 â”‚ Tareas con JOINS de todas las       â”‚
â”‚                                     â”‚ tablas relacionadas (estados,       â”‚
â”‚                                     â”‚ usuarios, inspecciones, etc.)       â”‚
â”‚                                     â”‚                                     â”‚
â”‚ VW_estadisticas_estados             â”‚ Conteos, promedios y totales por    â”‚
â”‚                                     â”‚ cada estado de tareas               â”‚
â”‚                                     â”‚                                     â”‚
â”‚ VW_dashboard_principal              â”‚ Resumen general: totales de tareas, â”‚
â”‚                                     â”‚ usuarios, inspecciones, costos      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”’ TRIGGERS (AUTOMÃTICOS)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trigger                             â”‚ AcciÃ³n                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TR_usuarios_update                  â”‚ Actualiza 'updated_at' en usuarios  â”‚
â”‚                                     â”‚ cada vez que se modifica un registroâ”‚
â”‚                                     â”‚                                     â”‚
â”‚ TR_tareas_update                    â”‚ Actualiza 'fecha_actualizacion' en  â”‚
â”‚                                     â”‚ tareas tras cualquier UPDATE        â”‚
â”‚                                     â”‚                                     â”‚
â”‚ TR_tareas_cambio_estado             â”‚ Cuando cambia id_estado:            â”‚
â”‚                                     â”‚ 1. Insertar en historial_estados    â”‚
â”‚                                     â”‚ 2. Actualizar fecha_inicio si pasa  â”‚
â”‚                                     â”‚    a 'in_progress'                  â”‚
â”‚                                     â”‚ 3. Actualizar fecha_finalizacion    â”‚
â”‚                                     â”‚    si pasa a 'done'                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ TIPOS DE DATOS IMPORTANTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UNIQUEIDENTIFIER:
  - Usado para user_id (compatibilidad con UUID de Node.js)
  - Generado con NEWID() o desde el frontend

NVARCHAR(MAX):
  - Usado para campos JSON (datos_completos, inspeccion_data)
  - Usado para imÃ¡genes base64 (data_base64)
  - Permite almacenar textos muy largos

DATETIME2:
  - Mayor precisiÃ³n que DATETIME
  - Usado para todos los timestamps

NVARCHAR vs VARCHAR:
  - NVARCHAR soporta Unicode (caracteres especiales, emojis, etc.)
  - Usado en todos los campos de texto


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” ÃNDICES CREADOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tabla: usuarios
  â”œâ”€ IX_usuarios_email (email)
  â”œâ”€ IX_usuarios_rol (rol)
  â””â”€ IX_usuarios_is_active (is_active)

Tabla: password_reset_tokens
  â”œâ”€ IX_reset_tokens_user_id (user_id)
  â””â”€ IX_reset_tokens_expires (expires_at)

Tabla: ubicaciones
  â”œâ”€ IX_ubicaciones_edificio (edificio)
  â””â”€ IX_ubicaciones_piso (piso)

Tabla: inspecciones
  â”œâ”€ IX_inspecciones_prioridad (prioridad)
  â”œâ”€ IX_inspecciones_edificio (edificio)
  â””â”€ IX_inspecciones_fecha (fecha_creacion)

Tabla: tareas
  â”œâ”€ IX_tareas_estado (id_estado)
  â”œâ”€ IX_tareas_asignado (asignado_user_id)
  â”œâ”€ IX_tareas_fecha (fecha)
  â”œâ”€ IX_tareas_prioridad (prioridad)
  â””â”€ IX_tareas_creacion (fecha_creacion)

Tabla: imagenes
  â”œâ”€ IX_imagenes_tarea (id_tarea)
  â””â”€ IX_imagenes_fecha (fecha_subida)

Tabla: historial_estados
  â”œâ”€ IX_historial_tarea (id_tarea)
  â””â”€ IX_historial_fecha (fecha_cambio)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ EJEMPLO DE CONSULTA COMPLETA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

-- Obtener todas las tareas con informaciÃ³n completa

SELECT 
    t.titulo,
    e.nombre_estado,
    u.nombre AS asignado_a,
    i.nombre_tarea AS inspeccion,
    t.fecha,
    t.prioridad,
    (SELECT COUNT(*) FROM imagenes WHERE id_tarea = t.id_tarea) AS total_imagenes,
    (SELECT TOP 1 comentario 
     FROM historial_estados 
     WHERE id_tarea = t.id_tarea 
     ORDER BY fecha_cambio DESC) AS ultimo_comentario
FROM tareas t
LEFT JOIN estados e ON t.id_estado = e.id_estado
LEFT JOIN usuarios u ON t.asignado_user_id = u.user_id
LEFT JOIN inspecciones i ON t.id_inspeccion = i.id_inspeccion
ORDER BY t.fecha_creacion DESC;


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Diagrama creado para: Planificador de Mantenimiento
VersiÃ³n: 1.0
Fecha: Octubre 2025
Compatible con: SQL Server 2016+

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

