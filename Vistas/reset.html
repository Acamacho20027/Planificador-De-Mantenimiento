<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer contraseña</title>
    <link rel="stylesheet" href="../Styles/styles.css">
    <link rel="stylesheet" href="../Styles/design-tokens.css">
    <style>
        .auth-container { max-width: 420px; margin: 60px auto; padding: 24px; border: 1px solid #ddd; border-radius: 8px; }
        .auth-field { display: flex; flex-direction: column; margin-bottom: 12px; }
    </style>
    <script>
    function getQueryParam(name){
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
    }
    async function getCsrf() {
        const res = await fetch('/auth/csrf', { credentials: 'include' });
        const json = await res.json();
        return json.csrfToken;
    }
    async function onSubmitReset(e){
        e.preventDefault();
        const email = getQueryParam('email');
        const id = getQueryParam('id');
        const token = getQueryParam('token');
        const new_password = document.getElementById('new_password').value;
        const csrf = await getCsrf();
        const res = await fetch('/auth/reset-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'x-csrf-token': csrf },
            credentials: 'include',
            body: JSON.stringify({ email, id, token, new_password })
        });
        const data = await res.json();
        const msg = document.getElementById('msg');
        if(res.ok){
            msg.style.color = '#4CAF50';
            msg.textContent = 'Contraseña cambiada. Ahora puedes iniciar sesión.';
        } else {
            msg.style.color = '#f44336';
            msg.textContent = data.error || 'Error al restablecer la contraseña';
        }
    }
    </script>
    </head>
<body>
    <div class="auth-container">
        <h2>Restablecer contraseña</h2>
        <form onsubmit="onSubmitReset(event)">
            <div class="auth-field">
                <label for="new_password">Nueva contraseña</label>
                <input id="new_password" name="new_password" type="password" required minlength="8" placeholder="••••••••" />
            </div>
            <button class="button_top" type="submit">Guardar</button>
            <div id="msg" style="margin-top:8px"></div>
        </form>
    </div>
</body>
</html>


