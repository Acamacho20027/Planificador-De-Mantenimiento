<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard - Planificador de Mantenimiento</title>
    <link rel="stylesheet" href="../Styles/styles.css">
    <link rel="stylesheet" href="../Styles/custom-dashboard.css">
    <link rel="stylesheet" href="../Styles/design-tokens.css">
    <link rel="stylesheet" href="../Styles/visual-overrides.css">
    <link rel="stylesheet" href="../Styles/mobile-nav.css">
</head>
<body>
    <header class="padding-global">
        <div class="container-large">
            <h1 class="heading-style-h1">Dashboard</h1>
        </div>
    </header>

    <main class="padding-global padding-section-large">
        <div class="container-large dashboard-wrapper">
            <!-- top navigation bar -->
            <button id="nav-toggle" aria-label="Abrir menú" style="background:transparent;border:none;cursor:pointer;" aria-expanded="false">
                <!-- SVG hamburger with thicker bars for better visibility on mobile/Safari -->
                <svg width="28" height="20" viewBox="0 0 28 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <rect x="0" y="0" width="28" height="3" rx="1.5" fill="currentColor" />
                    <rect x="0" y="8.5" width="28" height="3" rx="1.5" fill="currentColor" />
                    <rect x="0" y="17" width="28" height="3" rx="1.5" fill="currentColor" />
                </svg>
            </button>
            <aside class="dashboard-nav">
                <h3 class="heading-style-h3">Menú</h3>
                <nav>
                    <ul>
                        <li><a href="dashboard.html#home" class="dashboard-link" data-view="home">Home</a></li>
                        <li><a href="inspeccion.html" class="dashboard-link">Inspección</a></li>
                        <li><a href="dashboard.html#tasks" class="dashboard-link" data-view="tasks">Tareas</a></li>
                        <li><a href="dashboard.html#admin" class="dashboard-link" data-view="admin">Administración</a></li>
                        <li><a href="bitacoras.html" class="dashboard-link">Bitácoras</a></li>
                        <li class="nav-mobile-only">
                            <button type="button" id="menu-logout" class="dashboard-link logout-link">
                                <img src="/imagenes/icon-logout.svg" aria-hidden="true" style="height:16px;width:16px;filter:invert(1) grayscale(1) contrast(100%);">Cerrar sesión
                            </button>
                        </li>
                    </ul>
                </nav>
            </aside>

            <section class="dashboard-content">
                <div id="view-home" class="dashboard-view">
                    <div class="dashboard-hero">
                        <div>
                            <p class="eyebrow">Panel operativo</p>
                            <h2 class="heading-style-h2">Resumen de inspecciones</h2>
                            <p class="muted">Datos en vivo desde SQL Server.</p>
                        </div>
                        <div class="hero-actions">
                            <button type="button" class="small outline" id="btn-refresh-dashboard">Actualizar</button>
                        </div>
                    </div>

                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <p>Inspecciones / tareas</p>
                            <div class="kpi-value" id="kpi-total">--</div>
                            <span class="kpi-pill" id="kpi-updated">Sin datos</span>
                        </div>
                        <div class="kpi-card">
                            <p>Completadas</p>
                            <div class="kpi-value" id="kpi-done">--</div>
                            <span class="kpi-pill pill-success" id="kpi-done-pct">0%</span>
                        </div>
                        <div class="kpi-card">
                            <p>En progreso</p>
                            <div class="kpi-value" id="kpi-progress">--</div>
                            <span class="kpi-pill pill-info" id="kpi-progress-pct">0%</span>
                        </div>
                        <div class="kpi-card">
                            <p>No iniciadas</p>
                            <div class="kpi-value" id="kpi-notstarted">--</div>
                            <span class="kpi-pill pill-muted" id="kpi-notstarted-pct">0%</span>
                        </div>
                    </div>

                    <div class="chart-grid-pro">
                        <div class="chart-card-pro">
                            <div class="chart-head">
                                <div>
                                    <p class="eyebrow">Estados</p>
                                    <h4>Distribución de estados</h4>
                                </div>
                                <span class="pill" id="label-last-sync">Actualizando...</span>
                            </div>
                            <canvas id="chart-status" aria-label="Distribución por estado" role="img"></canvas>
                        </div>
                        <div class="chart-card-pro">
                            <div class="chart-head">
                                <div>
                                    <p class="eyebrow">Evolución</p>
                                    <h4>Inspecciones por fecha</h4>
                                </div>
                            </div>
                            <canvas id="chart-evolution" aria-label="Evolución temporal" role="img"></canvas>
                        </div>
                        <div class="chart-card-pro tall">
                            <div class="chart-head">
                                <div>
                                    <p class="eyebrow">Asignación</p>
                                    <h4>Por técnico</h4>
                                </div>
                            </div>
                            <canvas id="chart-technicians" aria-label="Carga por técnico" role="img"></canvas>
                        </div>
                    </div>
                </div>

                
                                <!-- Inspección moved to separate page (inspeccion.html) -->

                <div id="view-tasks" class="dashboard-view" style="display:none;">
                    <h3>Tareas</h3>
                    <div id="tasks-container">
                        <p>Cargando tareas...</p>
                    </div>
                </div>

                <div id="view-admin" class="dashboard-view" style="display:none;">
                    <h3>Administración de Usuarios</h3>
                    <div class="admin-mobile-logout">
                        <button type="button" id="admin-mobile-logout" class="admin-mobile-logout-btn">
                            <img src="/imagenes/icon-logout.svg" aria-hidden="true" style="height:16px;width:16px;filter:invert(1) grayscale(1) contrast(100%);">Cerrar sesión
                        </button>
                    </div>
                    <form id="form-crear-usuario" style="display:flex; gap:8px; align-items:flex-end; flex-wrap:wrap;">
                        <div>
                            <label for="nuevo-email">Email</label>
                            <input name="email" type="email" id="nuevo-email" required placeholder="usuario@empresa.com" />
                        </div>
                        <div>
                            <label for="nuevo-nombre">Nombre</label>
                            <input name="nombre" type="text" id="nuevo-nombre" placeholder="Nombre completo" />
                        </div>
                        <div>
                            <label for="nuevo-telefono">Teléfono</label>
                            <input name="telefono" type="tel" id="nuevo-telefono" placeholder="+1 234 567 8900" />
                        </div>
                        <div>
                            <label for="nuevo-rol">Rol</label>
                            <select name="rol" id="nuevo-rol"><option value="Usuario">Usuario</option><option value="Administrador">Administrador</option></select>
                        </div>
                        <button type="submit" class="button_top">Crear usuario</button>
                    </form>
                    <div id="lista-usuarios-admin" style="margin-top:12px;"></div>
                </div>
            </section>
        </div>
    </main>

    <script src="../js/vendor/chart.umd.min.js"></script>
    <script src="../js/charts.js"></script>
    <script src="../js/preview.js"></script>
    <script src="../js/dashboard.js"></script>
    <script src="../js/protect-dashboard.js"></script>
</body>
</html>
